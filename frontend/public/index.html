<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Tareas</title>
    <link rel="stylesheet" href="styles.css">  <!-- Si quieres agregar estilos -->
    <style>
        /* Estilos básicos para las funcionalidades añadidas */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 300px;
            background: #2c3e50;
            color: white;
            padding: 20px;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            background: #f5f7fa;
        }
        
        .profile-header {
            margin-bottom: 30px;
        }
        
        .profile-pic {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }
        
        .sidebar-card {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .sidebar-card:hover {
            transform: translateY(-3px);
        }
        
        .card-green {
            background: #2ecc71;
        }
        
        .card-blue {
            background: #3498db;
        }
        
        .card-yellow {
            background: #f39c12;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
        }
        
        .input-container {
            margin-bottom: 15px;
        }
        
        .input-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .input-container input, 
        .input-container select, 
        .input-container textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .btn-cancel, .btn-confirm {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .btn-cancel {
            background: #e74c3c;
            color: white;
        }
        
        .btn-confirm {
            background: #2ecc71;
            color: white;
        }
        
        .task-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .task-table th, .task-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        
        .task-table th {
            background: #3498db;
            color: white;
        }
        
        .estado {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .estado-pendiente {
            background: #f39c12;
            color: white;
        }
        
        .estado-en-progreso {
            background: #3498db;
            color: white;
        }
        
        .estado-completado {
            background: #2ecc71;
            color: white;
        }
        
        .cards {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .ver-mas-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }
        
        .calendar-view {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-weekday {
            text-align: center;
            font-weight: bold;
            padding: 5px;
        }
        
        .calendar-day {
            height: 80px;
            border: 1px solid #ddd;
            padding: 5px;
            overflow: auto;
        }
        
        .calendar-day.empty {
            background: #f9f9f9;
        }
        
        .calendar-day.today {
            background: #e3f2fd;
        }
        
        .calendar-day.has-tasks {
            background: #fff8e1;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .btn.green {
            background: #2ecc71;
            color: white;
        }
        
        .btn.purple {
            background: #9b59b6;
            color: white;
        }
        
        .toast-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            animation: slideIn 0.3s, fadeOut 0.5s 2.5s forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="sidebar">
            <div class="profile-header">
                <div class="profile-actions">
                    <span class="profile-link" id="logout-btn">Cerrar sesión</span>
                </div>
                <div class="profile-info">
                    <img class="profile-pic" id="profile-pic" src="/default-profile.png" alt="Profile">
                    <h2 class="user-name" id="user-name">Usuario</h2>
                    <p class="user-email" id="user-email">usuario@ejemplo.com</p>
                </div>
            </div>
            <div class="sidebar-card card-green" id="tareas-hoy-card">
                0 tareas para hoy
            </div>
            <div class="sidebar-card card-blue">Reunión con el equipo a las 10:00 AM</div>
            <div class="sidebar-card card-yellow" id="tareas-proximas-card">
                0 tareas próximas
            </div>
        </div>

        <div class="main-content">
            <div class="header">
                <div class="greeting-container">
                    <h1 class="greeting" id="greeting">¡Buenos días!</h1>
                    <p class="subtitle" id="subtitle">No tienes tareas para hoy</p>
                    <div class="action-buttons">
                        <button class="btn calendar-btn" id="toggle-calendar-btn">
                            <i class="icon-calendar"></i> Mostrar Calendario
                        </button>
                        <button class="btn completed-btn" id="toggle-completed-btn">
                            <i class="icon-check"></i> Mostrar Completadas
                        </button>
                    </div>
                </div>
                <div class="header-buttons">
                    <button class="btn green" id="new-task-btn">+ Nueva tarea</button>
                    <button class="btn purple" id="new-project-btn">+ Nuevo proyecto</button>
                </div>
            </div>

            <div class="toast-message" id="toast-message" style="display: none;"></div>

            <div class="calendar-view" id="calendar-view" style="display: none;">
                <div class="calendar-header">
                    <button id="prev-month-btn">&lt; Anterior</button>
                    <h2 id="calendar-month-year">ENERO 2023</h2>
                    <button id="next-month-btn">Siguiente &gt;</button>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- Se llenará dinámicamente con JavaScript -->
                </div>
            </div>

            <div class="cards" id="cards-view">
                <div class="card">
                    <div class="card-header">
                        <h3>Hoy</h3>
                        <button class="ver-mas-btn" id="ver-mas-hoy-btn" style="display: none;">...</button>
                    </div>
                    <ul id="tareas-hoy-list">
                        <li>No hay tareas para hoy</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Esta semana</h3>
                        <button class="ver-mas-btn" id="ver-mas-semana-btn" style="display: none;">...</button>
                    </div>
                    <ul id="tareas-semana-list">
                        <li>No hay tareas esta semana</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>En el mes</h3>
                        <button class="ver-mas-btn" id="ver-mas-mes-btn" style="display: none;">...</button>
                    </div>
                    <ul id="tareas-mes-list">
                        <li>No hay tareas este mes</li>
                    </ul>
                </div>
            </div>

            <table class="task-table" id="task-table">
                <thead>
                    <tr>
                        <th>Tarea</th>
                        <th>Proyecto</th>
                        <th>Responsable</th>
                        <th>Fecha de inicio</th>
                        <th>Fecha fin</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="task-table-body">
                    <!-- Se llenará dinámicamente con JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal Nueva Tarea -->
    <div class="modal" id="task-modal" style="display: none;">
        <div class="modal-content">
            <h2>Nueva tarea</h2>
            
            <div class="input-container">
                <label>Nombre de la tarea *</label>
                <input type="text" id="task-name" placeholder="Ej: Revisar diseño" required>
            </div>
            
            <div class="input-container">
                <label>Proyecto *</label>
                <select id="task-project" class="form-control" required>
                    <option value="">Seleccione un proyecto</option>
                </select>
            </div>
            
            <div class="input-container">
                <label>Responsable *</label>
                <input type="text" id="task-responsible" placeholder="Ej: María Gómez" required>
            </div>

            <div class="input-container">
                <label>Fecha de inicio *</label>
                <input type="date" id="task-start-date" required>
            </div>

            <div class="input-container">
                <label>Fecha fin *</label>
                <select id="task-end-date-option" class="form-control" required>
                    <option value="">Seleccione una opción</option>
                    <option value="hoy">Hoy</option>
                    <option value="3dias">3 días</option>
                    <option value="1semana">1 semana</option>
                    <option value="1mes">1 mes</option>
                    <option value="personalizado">Personalizado</option>
                </select>
            </div>

            <div class="input-container" id="custom-end-date-container" style="display: none;">
                <label>Seleccionar fecha específica *</label>
                <input type="date" id="task-custom-end-date">
            </div>
            
            <div class="modal-actions">
                <button class="btn-cancel" id="cancel-task-btn">Cancelar</button>
                <button class="btn-confirm" id="confirm-task-btn">Agregar tarea</button>
            </div>
        </div>
    </div>

    <!-- Modal Nuevo Proyecto -->
    <div class="modal" id="project-modal" style="display: none;">
        <div class="modal-content">
            <h2>Agregar nuevo proyecto</h2>
            
            <div class="input-container">
                <label>Nombre del proyecto *</label>
                <input type="text" id="project-name" placeholder="Ej: Sitio web corporativo" required>
            </div>
            
            <div class="input-container">
                <label>Descripción *</label>
                <textarea id="project-description" placeholder="Detalles del proyecto" rows="4" required></textarea>
            </div>
            
            <div class="modal-actions">
                <button class="btn-cancel" id="cancel-project-btn">Cancelar</button>
                <button class="btn-confirm" id="confirm-project-btn">Crear proyecto</button>
            </div>
        </div>
    </div>

    <!-- Modal para tareas de hoy -->
    <div class="modal" id="today-tasks-modal" style="display: none;">
        <div class="modal-content">
            <h2>Tareas para hoy</h2>
            <table class="task-table">
                <thead>
                    <tr>
                        <th>Tarea</th>
                        <th>Proyecto</th>
                        <th>Responsable</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="today-tasks-modal-body">
                    <!-- Se llenará dinámicamente con JavaScript -->
                </tbody>
            </table>
            <button class="btn-close" id="close-today-modal-btn">Cerrar</button>
        </div>
    </div>

    <!-- Modal para tareas de esta semana -->
    <div class="modal" id="week-tasks-modal" style="display: none;">
        <div class="modal-content">
            <h2>Tareas para esta semana</h2>
            <table class="task-table">
                <thead>
                    <tr>
                        <th>Tarea</th>
                        <th>Proyecto</th>
                        <th>Responsable</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="week-tasks-modal-body">
                    <!-- Se llenará dinámicamente con JavaScript -->
                </tbody>
            </table>
            <button class="btn-close" id="close-week-modal-btn">Cerrar</button>
        </div>
    </div>

    <!-- Modal para tareas de este mes -->
    <div class="modal" id="month-tasks-modal" style="display: none;">
        <div class="modal-content">
            <h2>Tareas para este mes</h2>
            <table class="task-table">
                <thead>
                    <tr>
                        <th>Tarea</th>
                        <th>Proyecto</th>
                        <th>Responsable</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="month-tasks-modal-body">
                    <!-- Se llenará dinámicamente con JavaScript -->
                </tbody>
            </table>
            <button class="btn-close" id="close-month-modal-btn">Cerrar</button>
        </div>
    </div>

    <script>
        // Datos de ejemplo (en una aplicación real estos vendrían de una API)
        let userProfile = {
            name: "Usuario Ejemplo",
            email: "usuario@ejemplo.com",
            picture: "/default-profile.png"
        };

        let tareas = [
            {
                id: 1,
                tarea: "Revisar diseño",
                proyecto: "Sitio web",
                responsable: "María Gómez",
                fechaInicio: "2023-05-01",
                fechaFin: "2023-05-03",
                estado: "Pendiente"
            },
            {
                id: 2,
                tarea: "Desarrollar API",
                proyecto: "Aplicación móvil",
                responsable: "Juan Pérez",
                fechaInicio: "2023-05-02",
                fechaFin: "2023-05-10",
                estado: "En progreso"
            },
            {
                id: 3,
                tarea: "Pruebas de usuario",
                proyecto: "Aplicación móvil",
                responsable: "Ana López",
                fechaInicio: "2023-05-15",
                fechaFin: "2023-05-20",
                estado: "Pendiente"
            }
        ];

        let proyectos = ["Sitio web", "Aplicación móvil", "Marketing digital"];

        // Estado de la aplicación
        let showCalendar = false;
        let showCompletedTasks = false;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let editingEstadoId = null;

        // Elementos del DOM
        const profilePic = document.getElementById('profile-pic');
        const userName = document.getElementById('user-name');
        const userEmail = document.getElementById('user-email');
        const greeting = document.getElementById('greeting');
        const subtitle = document.getElementById('subtitle');
        const tareasHoyCard = document.getElementById('tareas-hoy-card');
        const tareasProximasCard = document.getElementById('tareas-proximas-card');
        const toggleCalendarBtn = document.getElementById('toggle-calendar-btn');
        const toggleCompletedBtn = document.getElementById('toggle-completed-btn');
        const newTaskBtn = document.getElementById('new-task-btn');
        const newProjectBtn = document.getElementById('new-project-btn');
        const toastMessage = document.getElementById('toast-message');
        const calendarView = document.getElementById('calendar-view');
        const calendarMonthYear = document.getElementById('calendar-month-year');
        const calendarGrid = document.getElementById('calendar-grid');
        const prevMonthBtn = document.getElementById('prev-month-btn');
        const nextMonthBtn = document.getElementById('next-month-btn');
        const cardsView = document.getElementById('cards-view');
        const tareasHoyList = document.getElementById('tareas-hoy-list');
        const tareasSemanaList = document.getElementById('tareas-semana-list');
        const tareasMesList = document.getElementById('tareas-mes-list');
        const verMasHoyBtn = document.getElementById('ver-mas-hoy-btn');
        const verMasSemanaBtn = document.getElementById('ver-mas-semana-btn');
        const verMasMesBtn = document.getElementById('ver-mas-mes-btn');
        const taskTableBody = document.getElementById('task-table-body');
        const taskModal = document.getElementById('task-modal');
        const taskName = document.getElementById('task-name');
        const taskProject = document.getElementById('task-project');
        const taskResponsible = document.getElementById('task-responsible');
        const taskStartDate = document.getElementById('task-start-date');
        const taskEndDateOption = document.getElementById('task-end-date-option');
        const customEndDateContainer = document.getElementById('custom-end-date-container');
        const taskCustomEndDate = document.getElementById('task-custom-end-date');
        const cancelTaskBtn = document.getElementById('cancel-task-btn');
        const confirmTaskBtn = document.getElementById('confirm-task-btn');
        const projectModal = document.getElementById('project-modal');
        const projectName = document.getElementById('project-name');
        const projectDescription = document.getElementById('project-description');
        const cancelProjectBtn = document.getElementById('cancel-project-btn');
        const confirmProjectBtn = document.getElementById('confirm-project-btn');
        const todayTasksModal = document.getElementById('today-tasks-modal');
        const todayTasksModalBody = document.getElementById('today-tasks-modal-body');
        const closeTodayModalBtn = document.getElementById('close-today-modal-btn');
        const weekTasksModal = document.getElementById('week-tasks-modal');
        const weekTasksModalBody = document.getElementById('week-tasks-modal-body');
        const closeWeekModalBtn = document.getElementById('close-week-modal-btn');
        const monthTasksModal = document.getElementById('month-tasks-modal');
        const monthTasksModalBody = document.getElementById('month-tasks-modal-body');
        const closeMonthModalBtn = document.getElementById('close-month-modal-btn');
        const logoutBtn = document.getElementById('logout-btn');

        // Funciones auxiliares
        function formatDate(date) {
            return new Date(date).toLocaleDateString('es-ES');
        }

        function calcularFechaFin(opcion, fechaInicio) {
            const date = new Date(fechaInicio);
            
            switch(opcion) {
                case 'hoy':
                    return fechaInicio;
                case '3dias':
                    date.setDate(date.getDate() + 3);
                    break;
                case '1semana':
                    date.setDate(date.getDate() + 7);
                    break;
                case '1mes':
                    date.setMonth(date.getMonth() + 1);
                    break;
            }
            
            return date.toISOString().split('T')[0];
        }

        function renderCalendar() {
            // Limpiar el calendario
            calendarGrid.innerHTML = '';
            
            // Añadir días de la semana
            const weekdays = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
            weekdays.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-weekday';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            });
            
            // Obtener primer día del mes y día de la semana
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Añadir días vacíos al inicio si es necesario
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Añadir días del mes
            const today = new Date();
            for (let i = 1; i <= daysInMonth; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                // Verificar si es hoy
                if (i === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                // Verificar si hay tareas en este día
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                const hasTasks = tareas.some(t => t.fechaInicio === dateStr || t.fechaFin === dateStr);
                
                if (hasTasks) {
                    dayElement.classList.add('has-tasks');
                }
                
                dayElement.textContent = i;
                calendarGrid.appendChild(dayElement);
            }
            
            // Actualizar el título del mes/año
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", 
                              "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            calendarMonthYear.textContent = `${monthNames[currentMonth].toUpperCase()} ${currentYear}`;
        }

        function renderTaskTable(tasks) {
            taskTableBody.innerHTML = '';
            
            tasks.forEach(task => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${task.tarea}</td>
                    <td>${task.proyecto}</td>
                    <td>${task.responsable}</td>
                    <td>${formatDate(task.fechaInicio)}</td>
                    <td>${formatDate(task.fechaFin)}</td>
                    <td>
                        ${editingEstadoId === task.id ? 
                            `<select class="estado-selector" data-task-id="${task.id}">
                                <option value="Pendiente" ${task.estado === 'Pendiente' ? 'selected' : ''}>Pendiente</option>
                                <option value="En progreso" ${task.estado === 'En progreso' ? 'selected' : ''}>En progreso</option>
                                <option value="Completado" ${task.estado === 'Completado' ? 'selected' : ''}>Completado</option>
                            </select>` : 
                            `<span class="estado estado-${task.estado.toLowerCase().replace(' ', '-')}" data-task-id="${task.id}">
                                ${task.estado}
                            </span>`
                        }
                    </td>
                `;
                
                taskTableBody.appendChild(row);
            });
            
            // Agregar eventos a los estados
            document.querySelectorAll('.estado').forEach(el => {
                el.addEventListener('click', () => {
                    editingEstadoId = parseInt(el.getAttribute('data-task-id'));
                    renderTaskTable(tasks);
                });
            });
            
            // Agregar eventos a los selectores de estado
            document.querySelectorAll('.estado-selector').forEach(select => {
                select.addEventListener('change', (e) => {
                    const taskId = parseInt(e.target.getAttribute('data-task-id'));
                    const newEstado = e.target.value;
                    
                    // Actualizar el estado en los datos
                    const taskIndex = tareas.findIndex(t => t.id === taskId);
                    if (taskIndex !== -1) {
                        tareas[taskIndex].estado = newEstado;
                    }
                    
                    editingEstadoId = null;
                    renderTaskTable(tasks);
                    updateSidebarCards();
                });
                
                select.addEventListener('blur', () => {
                    editingEstadoId = null;
                    renderTaskTable(tasks);
                });
            });
        }

        function updateSidebarCards() {
            const hoy = new Date().toISOString().split('T')[0];
            const tareasHoy = tareas.filter(t => t.fechaInicio === hoy || t.fechaFin === hoy);
            
            // Calcular tareas de esta semana
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            const endOfWeek = new Date(today);
            endOfWeek.setDate(today.getDate() + (6 - today.getDay()));
            
            const tareasSemana = tareas.filter(t => {
                const taskDate = new Date(t.fechaInicio);
                return taskDate >= startOfWeek && taskDate <= endOfWeek;
            });
            
            // Calcular tareas de este mes
            const startOfMonth = new Date(currentYear, currentMonth, 1);
            const endOfMonth = new Date(currentYear, currentMonth + 1, 0);
            
            const tareasMes = tareas.filter(t => {
                const taskDate = new Date(t.fechaInicio);
                return taskDate >= startOfMonth && taskDate <= endOfMonth;
            });
            
            // Actualizar tarjetas del sidebar
            tareasHoyCard.textContent = `${tareasHoy.length} ${tareasHoy.length === 1 ? 'tarea' : 'tareas'} para hoy`;
            tareasProximasCard.textContent = `${tareasSemana.length + tareasMes.length} tareas próximas`;
            
            // Actualizar saludo y subtítulo
            const namePart = userProfile.name !== 'Usuario' ? `, ${userProfile.name.split(' ')[0]}` : '';
            greeting.textContent = `¡Buenos días${namePart}!`;
            
            if (tareasHoy.length === 0) {
                subtitle.textContent = 'No tienes tareas para hoy';
            } else {
                subtitle.textContent = `Tienes ${tareasHoy.length} tarea${tareasHoy.length !== 1 ? 's' : ''} para hoy`;
            }
            
            // Actualizar listas de tareas
            updateTaskLists(tareasHoy, tareasSemana, tareasMes);
        }

        function updateTaskLists(tareasHoy, tareasSemana, tareasMes) {
            // Actualizar lista de tareas de hoy
            tareasHoyList.innerHTML = '';
            if (tareasHoy.length === 0) {
                tareasHoyList.innerHTML = '<li>No hay tareas para hoy</li>';
            } else {
                tareasHoy.slice(0, 3).forEach(t => {
                    const li = document.createElement('li');
                    li.textContent = t.tarea;
                    tareasHoyList.appendChild(li);
                });
                
                // Mostrar botón "ver más" si hay más de 3 tareas
                verMasHoyBtn.style.display = tareasHoy.length > 3 ? 'block' : 'none';
            }
            
            // Actualizar lista de tareas de esta semana
            tareasSemanaList.innerHTML = '';
            if (tareasSemana.length === 0) {
                tareasSemanaList.innerHTML = '<li>No hay tareas esta semana</li>';
            } else {
                tareasSemana.slice(0, 3).forEach(t => {
                    const li = document.createElement('li');
                    li.textContent = t.tarea;
                    tareasSemanaList.appendChild(li);
                });
                
                // Mostrar botón "ver más" si hay más de 3 tareas
                verMasSemanaBtn.style.display = tareasSemana.length > 3 ? 'block' : 'none';
            }
            
            // Actualizar lista de tareas de este mes
            tareasMesList.innerHTML = '';
            if (tareasMes.length === 0) {
                tareasMesList.innerHTML = '<li>No hay tareas este mes</li>';
            } else {
                tareasMes.slice(0, 3).forEach(t => {
                    const li = document.createElement('li');
                    li.textContent = t.tarea;
                    tareasMesList.appendChild(li);
                });
                
                // Mostrar botón "ver más" si hay más de 3 tareas
                verMasMesBtn.style.display = tareasMes.length > 3 ? 'block' : 'none';
            }
        }

        function showToast(message) {
            toastMessage.textContent = message;
            toastMessage.style.display = 'block';
            
            setTimeout(() => {
                toastMessage.style.display = 'none';
            }, 3000);
        }

        // Inicialización
        function init() {
            // Configurar perfil de usuario
            profilePic.src = userProfile.picture;
            userName.textContent = userProfile.name;
            userEmail.textContent = userProfile.email;
            
            // Configurar fecha actual en el formulario de tarea
            const today = new Date().toISOString().split('T')[0];
            taskStartDate.value = today;
            
            // Llenar select de proyectos
            taskProject.innerHTML = '<option value="">Seleccione un proyecto</option>';
            proyectos.forEach(proyecto => {
                const option = document.createElement('option');
                option.value = proyecto;
                option.textContent = proyecto;
                taskProject.appendChild(option);
            });
            
            // Renderizar datos iniciales
            renderCalendar();
            renderTaskTable(tareas);
            updateSidebarCards();
            
            // Event listeners
            toggleCalendarBtn.addEventListener('click', () => {
                showCalendar = !showCalendar;
                calendarView.style.display = showCalendar ? 'block' : 'none';
                cardsView.style.display = showCalendar ? 'none' : 'flex';
                toggleCalendarBtn.textContent = showCalendar ? 'Ocultar Calendario' : 'Mostrar Calendario';
            });
            
            toggleCompletedBtn.addEventListener('click', () => {
                showCompletedTasks = !showCompletedTasks;
                toggleCompletedBtn.textContent = showCompletedTasks ? 'Ocultar Completadas' : 'Mostrar Completadas';
                
                const filteredTasks = showCompletedTasks ? 
                    tareas : 
                    tareas.filter(t => t.estado !== 'Completado');
                
                renderTaskTable(filteredTasks);
            });
            
            newTaskBtn.addEventListener('click', () => {
                taskModal.style.display = 'flex';
            });
            
            newProjectBtn.addEventListener('click', () => {
                projectModal.style.display = 'flex';
            });
            
            cancelTaskBtn.addEventListener('click', () => {
                taskModal.style.display = 'none';
            });
            
            confirmTaskBtn.addEventListener('click', () => {
                // Validar formulario
                if (!taskName.value || !taskProject.value || !taskResponsible.value || !taskStartDate.value || !taskEndDateOption.value) {
                    showToast('Por favor complete todos los campos obligatorios');
                    return;
                }
                
                // Crear nueva tarea
                const newTask = {
                    id: tareas.length + 1,
                    tarea: taskName.value,
                    proyecto: taskProject.value,
                    responsable: taskResponsible.value,
                    fechaInicio: taskStartDate.value,
                    fechaFin: taskEndDateOption.value === 'personalizado' ? taskCustomEndDate.value : 
                              calcularFechaFin(taskEndDateOption.value, taskStartDate.value),
                    estado: "Pendiente"
                };
                
                // Añadir a la lista de tareas
                tareas.push(newTask);
                
                // Limpiar formulario
                taskName.value = '';
                taskProject.value = '';
                taskResponsible.value = '';
                taskStartDate.value = today;
                taskEndDateOption.value = '';
                taskCustomEndDate.value = '';
                customEndDateContainer.style.display = 'none';
                
                // Cerrar modal
                taskModal.style.display = 'none';
                
                // Actualizar UI
                renderTaskTable(tareas);
                updateSidebarCards();
                renderCalendar();
                
                showToast('Tarea agregada correctamente');
            });
            
            cancelProjectBtn.addEventListener('click', () => {
                projectModal.style.display = 'none';
            });
            
            confirmProjectBtn.addEventListener('click', () => {
                // Validar formulario
                if (!projectName.value || !projectDescription.value) {
                    showToast('Por favor complete todos los campos obligatorios');
                    return;
                }
                
                // Añadir nuevo proyecto
                proyectos.push(projectName.value);
                
                // Limpiar formulario
                projectName.value = '';
                projectDescription.value = '';
                
                // Cerrar modal
                projectModal.style.display = 'none';
                
                // Actualizar select de proyectos en el modal de tareas
                taskProject.innerHTML = '<option value="">Seleccione un proyecto</option>';
                proyectos.forEach(proyecto => {
                    const option = document.createElement('option');
                    option.value = proyecto;
                    option.textContent = proyecto;
                    taskProject.appendChild(option);
                });
                
                showToast('Proyecto agregado correctamente');
            });
            
            taskEndDateOption.addEventListener('change', (e) => {
                if (e.target.value === 'personalizado') {
                    customEndDateContainer.style.display = 'block';
                    taskCustomEndDate.min = taskStartDate.value;
                } else {
                    customEndDateContainer.style.display = 'none';
                }
            });
            
            prevMonthBtn.addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar();
            });
            
            nextMonthBtn.addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar();
            });
            
            verMasHoyBtn.addEventListener('click', () => {
                const hoy = new Date().toISOString().split('T')[0];
                const tareasHoy = tareas.filter(t => t.fechaInicio === hoy || t.fechaFin === hoy);
                
                todayTasksModalBody.innerHTML = '';
                tareasHoy.forEach(t => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${t.tarea}</td>
                        <td>${t.proyecto}</td>
                        <td>${t.responsable}</td>
                        <td><span class="estado estado-${t.estado.toLowerCase().replace(' ', '-')}">${t.estado}</span></td>
                    `;
                    todayTasksModalBody.appendChild(row);
                });
                
                todayTasksModal.style.display = 'flex';
            });
            
            verMasSemanaBtn.addEventListener('click', () => {
                const today = new Date();
                const startOfWeek = new Date(today);
                startOfWeek.setDate(today.getDate() - today.getDay());
                const endOfWeek = new Date(today);
                endOfWeek.setDate(today.getDate() + (6 - today.getDay()));
                
                const tareasSemana = tareas.filter(t => {
                    const taskDate = new Date(t.fechaInicio);
                    return taskDate >= startOfWeek && taskDate <= endOfWeek;
                });
                
                weekTasksModalBody.innerHTML = '';
                tareasSemana.forEach(t => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${t.tarea}</td>
                        <td>${t.proyecto}</td>
                        <td>${t.responsable}</td>
                        <td><span class="estado estado-${t.estado.toLowerCase().replace(' ', '-')}">${t.estado}</span></td>
                    `;
                    weekTasksModalBody.appendChild(row);
                });
                
                weekTasksModal.style.display = 'flex';
            });
            
            verMasMesBtn.addEventListener('click', () => {
                const startOfMonth = new Date(currentYear, currentMonth, 1);
                const endOfMonth = new Date(currentYear, currentMonth + 1, 0);
                
                const tareasMes = tareas.filter(t => {
                    const taskDate = new Date(t.fechaInicio);
                    return taskDate >= startOfMonth && taskDate <= endOfMonth;
                });
                
                monthTasksModalBody.innerHTML = '';
                tareasMes.forEach(t => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${t.tarea}</td>
                        <td>${t.proyecto}</td>
                        <td>${t.responsable}</td>
                        <td><span class="estado estado-${t.estado.toLowerCase().replace(' ', '-')}">${t.estado}</span></td>
                    `;
                    monthTasksModalBody.appendChild(row);
                });
                
                monthTasksModal.style.display = 'flex';
            });
            
            closeTodayModalBtn.addEventListener('click', () => {
                todayTasksModal.style.display = 'none';
            });
            
            closeWeekModalBtn.addEventListener('click', () => {
                weekTasksModal.style.display = 'none';
            });
            
            closeMonthModalBtn.addEventListener('click', () => {
                monthTasksModal.style.display = 'none';
            });
            
            logoutBtn.addEventListener('click', () => {
                // Simular cierre de sesión
                localStorage.removeItem("token");
                window.location.href = "/login";
            });
            
            // Manejar clics fuera de los modales para cerrarlos
            window.addEventListener('click', (e) => {
                if (e.target === taskModal) {
                    taskModal.style.display = 'none';
                }
                if (e.target === projectModal) {
                    projectModal.style.display = 'none';
                }
                if (e.target === todayTasksModal) {
                    todayTasksModal.style.display = 'none';
                }
                if (e.target === weekTasksModal) {
                    weekTasksModal.style.display = 'none';
                }
                if (e.target === monthTasksModal) {
                    monthTasksModal.style.display = 'none';
                }
            });
        }

        // Iniciar la aplicación cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>